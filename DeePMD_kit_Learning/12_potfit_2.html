<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>potfit拟合单元素EAM势函数思路 | IfXie&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
    <meta name="description" content="The only way to do great work is to love what you do.">
    <meta name="keywords" content="Solid Mechanics, Molecular Dynamics, First-principles calculations, AI4S, Linux systems, anime, fitness, indie games on Steam">
    
    <link rel="preload" href="/assets/css/0.styles.2f1e26cc.css" as="style"><link rel="preload" href="/assets/js/app.9c486258.js" as="script"><link rel="preload" href="/assets/js/2.f32f27a2.js" as="script"><link rel="preload" href="/assets/js/63.18ac9a4c.js" as="script"><link rel="prefetch" href="/assets/js/1.f040fba8.js"><link rel="prefetch" href="/assets/js/10.59306fbb.js"><link rel="prefetch" href="/assets/js/100.7b4538e7.js"><link rel="prefetch" href="/assets/js/101.a3cb3c78.js"><link rel="prefetch" href="/assets/js/102.b882e9e2.js"><link rel="prefetch" href="/assets/js/103.2913dd2f.js"><link rel="prefetch" href="/assets/js/104.d3a0cd5f.js"><link rel="prefetch" href="/assets/js/105.319aea6d.js"><link rel="prefetch" href="/assets/js/106.357186b7.js"><link rel="prefetch" href="/assets/js/107.fbff94c9.js"><link rel="prefetch" href="/assets/js/108.5d523992.js"><link rel="prefetch" href="/assets/js/109.197bafec.js"><link rel="prefetch" href="/assets/js/11.80821831.js"><link rel="prefetch" href="/assets/js/110.eb22753d.js"><link rel="prefetch" href="/assets/js/111.928e928c.js"><link rel="prefetch" href="/assets/js/112.8ae69d38.js"><link rel="prefetch" href="/assets/js/113.c7737fd8.js"><link rel="prefetch" href="/assets/js/114.71152f49.js"><link rel="prefetch" href="/assets/js/115.22a0ecef.js"><link rel="prefetch" href="/assets/js/116.03abf1dc.js"><link rel="prefetch" href="/assets/js/117.5c3e5654.js"><link rel="prefetch" href="/assets/js/118.5d83ddd4.js"><link rel="prefetch" href="/assets/js/119.4391c838.js"><link rel="prefetch" href="/assets/js/12.ddb94bcf.js"><link rel="prefetch" href="/assets/js/120.36fbf336.js"><link rel="prefetch" href="/assets/js/121.e55915fd.js"><link rel="prefetch" href="/assets/js/122.c266d959.js"><link rel="prefetch" href="/assets/js/123.d6bc5ec7.js"><link rel="prefetch" href="/assets/js/124.b4d8fc90.js"><link rel="prefetch" href="/assets/js/125.ffe215e2.js"><link rel="prefetch" href="/assets/js/126.830ed526.js"><link rel="prefetch" href="/assets/js/127.3f3ef909.js"><link rel="prefetch" href="/assets/js/128.905a9558.js"><link rel="prefetch" href="/assets/js/129.7c559c39.js"><link rel="prefetch" href="/assets/js/13.6256f6c5.js"><link rel="prefetch" href="/assets/js/130.1f1426bd.js"><link rel="prefetch" href="/assets/js/131.7ad8f812.js"><link rel="prefetch" href="/assets/js/132.4e82776f.js"><link rel="prefetch" href="/assets/js/133.e61b4a6b.js"><link rel="prefetch" href="/assets/js/134.108d2014.js"><link rel="prefetch" href="/assets/js/135.8efa472a.js"><link rel="prefetch" href="/assets/js/136.2064a2fd.js"><link rel="prefetch" href="/assets/js/137.6227833d.js"><link rel="prefetch" href="/assets/js/138.348c8a37.js"><link rel="prefetch" href="/assets/js/139.70699fb1.js"><link rel="prefetch" href="/assets/js/14.efb30487.js"><link rel="prefetch" href="/assets/js/140.12895e06.js"><link rel="prefetch" href="/assets/js/141.48b3c0b0.js"><link rel="prefetch" href="/assets/js/142.2f163b88.js"><link rel="prefetch" href="/assets/js/143.2320ddaf.js"><link rel="prefetch" href="/assets/js/144.83ff8b16.js"><link rel="prefetch" href="/assets/js/145.c6373ec7.js"><link rel="prefetch" href="/assets/js/146.5851b35b.js"><link rel="prefetch" href="/assets/js/147.727ff49a.js"><link rel="prefetch" href="/assets/js/148.7a70ba27.js"><link rel="prefetch" href="/assets/js/149.a12d3fd6.js"><link rel="prefetch" href="/assets/js/15.f251e49d.js"><link rel="prefetch" href="/assets/js/150.87e5a40b.js"><link rel="prefetch" href="/assets/js/16.9687589b.js"><link rel="prefetch" href="/assets/js/17.9c44cce5.js"><link rel="prefetch" href="/assets/js/18.10f84164.js"><link rel="prefetch" href="/assets/js/19.c5d1f6ed.js"><link rel="prefetch" href="/assets/js/20.d755d345.js"><link rel="prefetch" href="/assets/js/21.0c64ffdc.js"><link rel="prefetch" href="/assets/js/22.3b67a38d.js"><link rel="prefetch" href="/assets/js/23.c96f7cb1.js"><link rel="prefetch" href="/assets/js/24.1606b17f.js"><link rel="prefetch" href="/assets/js/25.ea925fa4.js"><link rel="prefetch" href="/assets/js/26.05c635af.js"><link rel="prefetch" href="/assets/js/27.813cc44c.js"><link rel="prefetch" href="/assets/js/28.560c17f2.js"><link rel="prefetch" href="/assets/js/29.8af9e9d0.js"><link rel="prefetch" href="/assets/js/3.19614c39.js"><link rel="prefetch" href="/assets/js/30.a0a9085a.js"><link rel="prefetch" href="/assets/js/31.0e02f6ae.js"><link rel="prefetch" href="/assets/js/32.2e81736d.js"><link rel="prefetch" href="/assets/js/33.dbb2e37b.js"><link rel="prefetch" href="/assets/js/34.8817c213.js"><link rel="prefetch" href="/assets/js/35.1b626213.js"><link rel="prefetch" href="/assets/js/36.debc6b9b.js"><link rel="prefetch" href="/assets/js/37.8fbbf403.js"><link rel="prefetch" href="/assets/js/38.be4e3b9c.js"><link rel="prefetch" href="/assets/js/39.7941b24a.js"><link rel="prefetch" href="/assets/js/4.feb0bb9f.js"><link rel="prefetch" href="/assets/js/40.f814b72f.js"><link rel="prefetch" href="/assets/js/41.ddc36eba.js"><link rel="prefetch" href="/assets/js/42.a09def9c.js"><link rel="prefetch" href="/assets/js/43.e25af04b.js"><link rel="prefetch" href="/assets/js/44.ae7fcb0b.js"><link rel="prefetch" href="/assets/js/45.7b8f8be4.js"><link rel="prefetch" href="/assets/js/46.fcad4f9b.js"><link rel="prefetch" href="/assets/js/47.28914c29.js"><link rel="prefetch" href="/assets/js/48.96dc072a.js"><link rel="prefetch" href="/assets/js/49.97e4f983.js"><link rel="prefetch" href="/assets/js/5.3cc4c5df.js"><link rel="prefetch" href="/assets/js/50.aebe629b.js"><link rel="prefetch" href="/assets/js/51.77b017f4.js"><link rel="prefetch" href="/assets/js/52.bd7be5f2.js"><link rel="prefetch" href="/assets/js/53.17d218c1.js"><link rel="prefetch" href="/assets/js/54.5a8125a7.js"><link rel="prefetch" href="/assets/js/55.332bddf6.js"><link rel="prefetch" href="/assets/js/56.29244c51.js"><link rel="prefetch" href="/assets/js/57.66475fa7.js"><link rel="prefetch" href="/assets/js/58.187652b7.js"><link rel="prefetch" href="/assets/js/59.f1a43e2f.js"><link rel="prefetch" href="/assets/js/6.a4b9836b.js"><link rel="prefetch" href="/assets/js/60.2c9ebf3f.js"><link rel="prefetch" href="/assets/js/61.4a1a5d31.js"><link rel="prefetch" href="/assets/js/62.d14f1205.js"><link rel="prefetch" href="/assets/js/64.84621590.js"><link rel="prefetch" href="/assets/js/65.91962938.js"><link rel="prefetch" href="/assets/js/66.b4a5fe40.js"><link rel="prefetch" href="/assets/js/67.b088bdf4.js"><link rel="prefetch" href="/assets/js/68.2c662240.js"><link rel="prefetch" href="/assets/js/69.d997935a.js"><link rel="prefetch" href="/assets/js/7.7d37706f.js"><link rel="prefetch" href="/assets/js/70.d9461a3b.js"><link rel="prefetch" href="/assets/js/71.5278eede.js"><link rel="prefetch" href="/assets/js/72.7cd02880.js"><link rel="prefetch" href="/assets/js/73.451788c0.js"><link rel="prefetch" href="/assets/js/74.2a9a538a.js"><link rel="prefetch" href="/assets/js/75.aa3eff14.js"><link rel="prefetch" href="/assets/js/76.0d18e104.js"><link rel="prefetch" href="/assets/js/77.1ae648f7.js"><link rel="prefetch" href="/assets/js/78.9f15b54c.js"><link rel="prefetch" href="/assets/js/79.5759a0c8.js"><link rel="prefetch" href="/assets/js/80.bf0290c0.js"><link rel="prefetch" href="/assets/js/81.934f2080.js"><link rel="prefetch" href="/assets/js/82.29cd1378.js"><link rel="prefetch" href="/assets/js/83.14985af4.js"><link rel="prefetch" href="/assets/js/84.d7bb9507.js"><link rel="prefetch" href="/assets/js/85.b1bb4477.js"><link rel="prefetch" href="/assets/js/86.07ce17dc.js"><link rel="prefetch" href="/assets/js/87.2a724f30.js"><link rel="prefetch" href="/assets/js/88.ca081bce.js"><link rel="prefetch" href="/assets/js/89.d00ec8dd.js"><link rel="prefetch" href="/assets/js/90.d1e8c9bb.js"><link rel="prefetch" href="/assets/js/91.f890d136.js"><link rel="prefetch" href="/assets/js/92.93f4fab5.js"><link rel="prefetch" href="/assets/js/93.2abbd8e1.js"><link rel="prefetch" href="/assets/js/94.229c0945.js"><link rel="prefetch" href="/assets/js/95.7fb400de.js"><link rel="prefetch" href="/assets/js/96.91e5206d.js"><link rel="prefetch" href="/assets/js/97.a00c1755.js"><link rel="prefetch" href="/assets/js/98.a48c772b.js"><link rel="prefetch" href="/assets/js/99.c7832af4.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.43e98a13.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2f1e26cc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="IfXie's Blog" class="logo"> <span class="site-name can-hide">IfXie's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/VASP_Learning/" class="nav-link">
  VASP学习路线
</a></div> <a href="https://github.com/IfXie-Solid-Mechanics/my-first-repo" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/VASP_Learning/" class="nav-link">
  VASP学习路线
</a></div> <a href="https://github.com/IfXie-Solid-Mechanics/my-first-repo" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>potfit拟合单元素EAM势函数思路</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/DeePMD_kit_Learning/12_potfit_2.html#_1-对接vasp结果" class="sidebar-link">1. 对接VASP结果</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/DeePMD_kit_Learning/12_potfit_2.html#_1-1-格式转化" class="sidebar-link">1.1 格式转化</a></li><li class="sidebar-sub-header"><a href="/DeePMD_kit_Learning/12_potfit_2.html#_1-2-选项讲解" class="sidebar-link">1.2 选项讲解</a></li><li class="sidebar-sub-header"><a href="/DeePMD_kit_Learning/12_potfit_2.html#_1-3-config文件生成格式" class="sidebar-link">1.3 config文件生成格式</a></li></ul></li><li><a href="/DeePMD_kit_Learning/12_potfit_2.html#_2-设置待拟合函数" class="sidebar-link">2. 设置待拟合函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/DeePMD_kit_Learning/12_potfit_2.html#_2-1-解析函数拟合简介" class="sidebar-link">2.1 解析函数拟合简介</a></li><li class="sidebar-sub-header"><a href="/DeePMD_kit_Learning/12_potfit_2.html#_2-1-1-header部分" class="sidebar-link" style="padding-left:3rem;">2.1.1 Header部分</a></li><li class="sidebar-sub-header"><a href="/DeePMD_kit_Learning/12_potfit_2.html#_2-1-2-解析函数的body部分" class="sidebar-link" style="padding-left:3rem;">2.1.2 解析函数的Body部分</a></li><li class="sidebar-sub-header"><a href="/DeePMD_kit_Learning/12_potfit_2.html#_2-1-3-smooth-cutoff" class="sidebar-link" style="padding-left:3rem;">2.1.3 Smooth cutoff</a></li><li class="sidebar-sub-header"><a href="/DeePMD_kit_Learning/12_potfit_2.html#_2-2-eam势函数设置" class="sidebar-link">2.2 EAM势函数设置</a></li></ul></li><li><a href="/DeePMD_kit_Learning/12_potfit_2.html#_3-程序控制" class="sidebar-link">3. 程序控制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/DeePMD_kit_Learning/12_potfit_2.html#_3-1-例子引入" class="sidebar-link">3.1 例子引入</a></li></ul></li><li><a href="/DeePMD_kit_Learning/12_potfit_2.html#_4-运行结果" class="sidebar-link">4. 运行结果</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="content single-column"><div class="main-content"><div class="theme-default-content custom-content content__default"><h1 id="potfit拟合单元素eam势函数思路"><a href="#potfit拟合单元素eam势函数思路" class="header-anchor">#</a> potfit拟合单元素EAM势函数思路</h1> <p>主要目的是先深入了解potfit工具。</p> <p>Potfit拟合势函数需要3个输入文件：</p> <p>第一个是Configuration文件，需要以config为前缀，比如config.single,config.ifxie等，这一文件将在第一部分讲解；</p> <p>第二个是Potential文件，这一文件和待拟合的势函数相关，是一个纯文本文件，对于前后缀没有特殊要求，将作为第二部分讲解；</p> <p>第三个是parameter文件，这个文件控制程序运行的相关参数，需要以param为后缀命名，比如ifxie.param文件，这一文件将在第三部分讲解。</p> <p>第四部分是拟合出的EAM势函数的效果。</p> <h2 id="_1-对接vasp结果"><a href="#_1-对接vasp结果" class="header-anchor">#</a> 1. 对接VASP结果</h2> <p>最重要的一点：potfit也是默认周期性边界条件的。</p> <h3 id="_1-1-格式转化"><a href="#_1-1-格式转化" class="header-anchor">#</a> 1.1 格式转化</h3> <p>之前解压得到的potfit目录中存在一个util目录，其中有一系列python脚本，作者对这些脚本的介绍在<a href="https://potfit.net/wiki/doku.php?id=utilities:main" target="_blank" rel="noopener noreferrer">这里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>(官网上说的命令行脚本是老版本使用的，在<code>util/old/</code>目录下可以找到，用bash写的，其实也能用，但是我使用的还是新版本)</p> <p>其中，vasp2force是我们需要用到的可执行程序，用下面命令查看说明文档：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>./vasp2force <span class="token parameter variable">-h</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>我们将Ni单质数据集的OUTCAR作为我们的拟合数据，演示命令如下所示：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>./vasp2force <span class="token parameter variable">-c</span> <span class="token assign-left variable">Ni</span><span class="token operator">=</span><span class="token number">0</span> <span class="token parameter variable">-a</span> <span class="token parameter variable">-r</span> Ni_training_data/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>Ni_training_data/</code>目录及其子目录下总计放了680个OUTCAR文件。</p> <p>第一次尝试这个时，其直接将所有结果打印在屏幕上，而没有形成文件，我初步的猜测也许和后续的工作流控制相关，先跳过这个小细节，因为后续自己想保存文件也是十分简单的工作:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>./vasp2force <span class="token parameter variable">-c</span> <span class="token assign-left variable">Ni</span><span class="token operator">=</span><span class="token number">0</span> <span class="token parameter variable">-a</span> <span class="token parameter variable">-r</span> Ni_training_data/ <span class="token operator">&gt;</span> Ni.config <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_1-2-选项讲解"><a href="#_1-2-选项讲解" class="header-anchor">#</a> 1.2 选项讲解</h3> <p><code>-c</code>选项允许设置<code>element list</code>，一般格式如下所示：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token parameter variable">-c</span> <span class="token assign-left variable">Mg</span><span class="token operator">=</span><span class="token number">0</span>,Zn<span class="token operator">=</span><span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>-e</code>选项在说明文档中没有详细说这个选项是怎么运作的，并且我认为极具误导性，所以我们可以直接阅读python脚本进行查看：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>    <span class="token keyword">def</span> <span class="token function">read_single_atom_energies</span><span class="token punctuation">(</span>sae_file<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            lines <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">for</span> line <span class="token keyword">in</span> <span class="token builtin">open</span><span class="token punctuation">(</span>sae_file<span class="token punctuation">,</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                lines <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token keyword">if</span> lines <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">:</span>
                sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">&quot;Single atom energy file contains more than one line!\n&quot;</span><span class="token punctuation">)</span>
                sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>sae_file<span class="token punctuation">,</span> <span class="token string">&quot;r&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                vasp_config<span class="token punctuation">.</span>single_atom_energy <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">float</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">&quot;Error reading single atom energy file!\n&quot;</span><span class="token punctuation">)</span>
            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>sae应该是single atom energy的缩写。并且从代码的上下文可以看出这个地方对于文件名称没有特殊要求，要求是一个纯文本文件。然后我们再来看其被调用部分：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>                ConfigData<span class="token punctuation">.</span>Energy <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>vasp_config<span class="token punctuation">.</span>single_atom_energy<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>vasp_config<span class="token punctuation">.</span>single_atom_energy<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>atoms_per_type<span class="token punctuation">)</span><span class="token punctuation">:</span>
                        sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">&quot;Invalid number of items in single atom energy file.\n&quot;</span><span class="token punctuation">)</span>
                        sys<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">&quot;Expected {} but found {}.\n&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>atoms_per_type<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>vasp_config<span class="token punctuation">.</span>single_atom_energy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>atoms_per_type<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        ConfigData<span class="token punctuation">.</span>Energy <span class="token operator">-=</span> self<span class="token punctuation">.</span>atoms_per_type<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> vasp_config<span class="token punctuation">.</span>single_atom_energy<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
                ConfigData<span class="token punctuation">.</span>Energy <span class="token operator">/=</span> self<span class="token punctuation">.</span>natoms
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>从这里可以看出，single atom energy并非表示读取每个原子的能量，而是起到确认势能零点的作用，这个在多元素编程中可能可能有用（各个元素的势能零点物理意义不统一时）。</p> <p>很明显，potfit仍然停留于对于总能量的拟合，而并不在意各个原子的能量，这一点和DeePMD类似(DeePMD虽然读取各个原子的能量，但是损失函数还是用的总能量)。</p> <p>而且potfit读入了力的信息，但是我读到现在对于其如何使用这个信息还是有一定存疑的，毕竟其用纯C++代码进行开发，文献中对于求导方法的描述比较模糊。</p> <p><code>-a</code>选项是指利用上所有的OUTCAR构型，还有其他选项可以选择来划分拟合集和验证集。</p> <p><code>-r</code>选项是递归查找的意思，和Linux许多命令的<code>-r</code>选项一致。需要注意的是查找的标准是以<code>OUTCAR*</code>进行的，也就是OUTCAR需要为前缀而非后缀。</p> <h3 id="_1-3-config文件生成格式"><a href="#_1-3-config文件生成格式" class="header-anchor">#</a> 1.3 config文件生成格式</h3> <p>首先是Header部分：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#N 108 1</span>
<span class="token comment">#C Ni</span>
<span class="token comment">## force file generated from file Ni_training_data/result_Ni_300K_distorted_7/dir_POSCAR-029/OUTCAR config 1</span>
<span class="token comment">#X   10.54800000    0.00000000    0.00000000</span>
<span class="token comment">#Y    0.52740000   10.54800000    0.00000000</span>
<span class="token comment">#Z    0.00000000    0.00000000   10.54800000</span>
<span class="token comment">#W 1.000000</span>
<span class="token comment">#E -5.3805377393</span>
<span class="token comment">#F</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>其中，W表示权重，也就是说我们可以给可信度高的数据集更高的权重进行拟合。</p> <p>E表示原子平均势能，单位为eV。</p> <p>F表示Header部分结束。</p> <p>接下来是Body部分，这一部分的每一行代表一个原子的种类、坐标和受力（7列），总共行数和原子数目一致，其中某一行如下所示：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">0</span>     <span class="token number">9.09263</span>     <span class="token number">7.06123</span>     <span class="token number">8.73441</span>     <span class="token number">0.39662</span>   <span class="token parameter variable">-0.476214</span>    <span class="token number">0.248166</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_2-设置待拟合函数"><a href="#_2-设置待拟合函数" class="header-anchor">#</a> 2. 设置待拟合函数</h2> <p>经过上一步，我们已经获得了可以用于拟合的数据集(config)，而这一步我们将设置使用EAM的方式对于函数进行拟合。</p> <p>首先potfit给出了三种拟合势函数的方法，分别是解析函数拟合，OpenKIM拟合以及打表拟合。我们这里使用解析函数进行拟合</p> <h3 id="_2-1-解析函数拟合简介"><a href="#_2-1-解析函数拟合简介" class="header-anchor">#</a> 2.1 解析函数拟合简介</h3> <p>类似于构型文件，每一个势函数文件也包括两个部分：Header和Body部分。</p> <h4 id="_2-1-1-header部分"><a href="#_2-1-1-header部分" class="header-anchor">#</a> 2.1.1 Header部分</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#F &lt;format&gt; &lt;count&gt;</span>
<span class="token comment">#T &lt;interaction name&gt;</span>
<span class="token comment">#C &lt;element 0&gt; &lt;element 1&gt; ...</span>
<span class="token comment">#I 0 1 ... n entries</span>
<span class="token comment">#G 2 3 ... n entries</span>
<span class="token comment">#E</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>第一行的<code>#F</code>后面跟着两个参数表明拟合势函数方法选择，因为我们使用的是解析函数进行拟合，所以直接输入<code>Format 0</code>即可，然后再加上所使用的函数个数。</p> <p>第二行的<code>#T</code>是可选的，后面跟着一个字符串用于命名。</p> <p>第三行的<code>#C</code>后面跟着元素名称，需要注意这里影响着一个顺序：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#C Al Pd Mn
## Al-Al Al-Pd Al-Mn Pd-Pd Pd-Mn Mn-Mn Al Pd Mn Al Pd Mn
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>第四行，<code>#I</code>是可选的，定义在力匹配运行期间是否应保持整个势函数恒定。每个参数对应一个函数，因此需要与势函数数量相同的数字。值为0允许potfit更改相应的势函数，值为1将其固定。例如，在向二元系统添加第三组分且仅允许附加势函数发生变化时，这非常有用。如果省略此行，则所有势函数都将进行优化。</p> <p>第五行，<code>#G</code>是可选的，指定插值样条的梯度是应被视为固定还是作为额外自由度。每个参数对应一个势函数，因此总共有n个参数。信息是位编码的：0表示上下梯度均固定，1允许调整上端点处的梯度，2允许调整下端点处的梯度，3允许调整两端点的梯度。<code>此设置不适用于解析势，因为解析势函数的求解是求出函数中的参数，而非样条差值打表。</code></p> <p>最后一行用<code>#E</code>结尾，表示Header部分结束。</p> <h4 id="_2-1-2-解析函数的body部分"><a href="#_2-1-2-解析函数的body部分" class="header-anchor">#</a> 2.1.2 解析函数的Body部分</h4> <p>这一部分主要介绍<code>Format 0</code>时，对应的势函数的Body部分：</p> <p>首先，所有的解析势函数的形式都可以在<a href="https://potfit.net/wiki/doku.php?id=models:analytic_functions" target="_blank" rel="noopener noreferrer">这个地方<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>查看，并且还有教程允许你定义自己的解析势函数。</p> <p>一般格式如下所示：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>type identifier
cutoff value
param_1 value min max
param_2 value min max
...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>type</code>表示使用的势函数，后面跟着势函数的对应名称（可以用它已经写好的，也可以用你自己写的）；</p> <p><code>cutoff</code>表示截断半径，单位为埃，每个势函数可以设置不同的截断半径；</p> <p><code>param_n</code>对应势函数中的各个参数，顺序十分重要，后面的3个参数分别是初始值、最大值、最小值。如果三个值相同，程序会将这个参数识别为固定参数，后续不进行优化。</p> <h4 id="_2-1-3-smooth-cutoff"><a href="#_2-1-3-smooth-cutoff" class="header-anchor">#</a> 2.1.3 Smooth cutoff</h4> <p>如果你希望拟合的函数在截断半径处足够光滑，那么可以在type后面增加一个识别符号<code>_sc</code>:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>type lj_sc
cutoff 7
epsilon 0.1 0 1
sigma 2.5 1 4
h 1 0 2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>它会调整为<mjx-container jax="SVG" class="MathJax" style="direction:ltr;position:relative;"><svg xmlns="http://www.w3.org/2000/svg" width="21.981ex" height="2.765ex" role="img" focusable="false" viewBox="0 -869.3 9715.7 1222.1" aria-hidden="true" style="overflow:visible;min-height:1px;min-width:1px;vertical-align:-0.798ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D449" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z" style="stroke-width:3;"></path></g><g data-mml-node="TeXAtom" transform="translate(616,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D446" d="M308 24Q367 24 416 76T466 197Q466 260 414 284Q308 311 278 321T236 341Q176 383 176 462Q176 523 208 573T273 648Q302 673 343 688T407 704H418H425Q521 704 564 640Q565 640 577 653T603 682T623 704Q624 704 627 704T632 705Q645 705 645 698T617 577T585 459T569 456Q549 456 549 465Q549 471 550 475Q550 478 551 494T553 520Q553 554 544 579T526 616T501 641Q465 662 419 662Q362 662 313 616T263 510Q263 480 278 458T319 427Q323 425 389 408T456 390Q490 379 522 342T554 242Q554 216 546 186Q541 164 528 137T492 78T426 18T332 -20Q320 -22 298 -22Q199 -22 144 33L134 44L106 13Q83 -14 78 -18T65 -22Q52 -22 52 -14Q52 -11 110 221Q112 227 130 227H143Q149 221 149 216Q149 214 148 207T144 186T142 153Q144 114 160 87T203 47T255 29T308 24Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(645,0)"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z" style="stroke-width:3;"></path></g></g></g><g data-mml-node="mo" transform="translate(1659.5,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(2048.5,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(2499.5,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(3166.3,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(4222,0)"><path data-c="1D713" d="M161 441Q202 441 226 417T250 358Q250 338 218 252T187 127Q190 85 214 61Q235 43 257 37Q275 29 288 29H289L371 360Q455 691 456 692Q459 694 472 694Q492 694 492 687Q492 678 411 356Q329 28 329 27T335 26Q421 26 498 114T576 278Q576 302 568 319T550 343T532 361T524 384Q524 405 541 424T583 443Q602 443 618 425T634 366Q634 337 623 288T605 220Q573 125 492 57T329 -11H319L296 -104Q272 -198 272 -199Q270 -205 252 -205H239Q233 -199 233 -197Q233 -192 256 -102T279 -9Q272 -8 265 -8Q106 14 106 139Q106 174 139 264T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 299 34 333T82 404T161 441Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(4873,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z" style="stroke-width:3;"></path></g><g data-mml-node="mfrac" transform="translate(5262,0)"><g data-mml-node="mrow" transform="translate(220,457.1) scale(0.707)"><g data-mml-node="mi"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(451,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z" style="stroke-width:3;"></path></g><g data-mml-node="msub" transform="translate(1229,0)"><g data-mml-node="mi"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z" style="stroke-width:3;"></path></g><g data-mml-node="TeXAtom" transform="translate(484,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z" style="stroke-width:3;"></path></g></g></g></g><g data-mml-node="mi" transform="translate(829.7,-345) scale(0.707)"><path data-c="210E" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z" style="stroke-width:3;"></path></g><rect width="1826.6" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(7328.7,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(7717.7,0)"><path data-c="1D449" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(8486.7,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(8875.7,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(9326.7,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z" style="stroke-width:3;"></path></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline" style="top:0px;left:0px;clip:rect(1px, 1px, 1px, 1px);-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:absolute;padding:1px 0px 0px 0px;border:0px;display:block;width:auto;overflow:hidden;"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>V</mi><mrow data-mjx-texclass="ORD"><mi>S</mi><mi>C</mi></mrow></msub><mo stretchy="false">(</mo><mi>r</mi><mo stretchy="false">)</mo><mo>=</mo><mi>ψ</mi><mo stretchy="false">(</mo><mfrac><mrow><mi>r</mi><mo>−</mo><msub><mi>r</mi><mrow data-mjx-texclass="ORD"><mi>C</mi></mrow></msub></mrow><mi>h</mi></mfrac><mo stretchy="false">)</mo><mi>V</mi><mo stretchy="false">(</mo><mi>r</mi><mo stretchy="false">)</mo></math></mjx-assistive-mml></mjx-container>，同时也会增加一个参数h来进行优化。</p> <p>其中，<mjx-container jax="SVG" class="MathJax" style="direction:ltr;position:relative;"><svg xmlns="http://www.w3.org/2000/svg" width="12.198ex" height="3.235ex" role="img" focusable="false" viewBox="0 -989.2 5391.4 1430" aria-hidden="true" style="overflow:visible;min-height:1px;min-width:1px;vertical-align:-0.997ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D713" d="M161 441Q202 441 226 417T250 358Q250 338 218 252T187 127Q190 85 214 61Q235 43 257 37Q275 29 288 29H289L371 360Q455 691 456 692Q459 694 472 694Q492 694 492 687Q492 678 411 356Q329 28 329 27T335 26Q421 26 498 114T576 278Q576 302 568 319T550 343T532 361T524 384Q524 405 541 424T583 443Q602 443 618 425T634 366Q634 337 623 288T605 220Q573 125 492 57T329 -11H319L296 -104Q272 -198 272 -199Q270 -205 252 -205H239Q233 -199 233 -197Q233 -192 256 -102T279 -9Q272 -8 265 -8Q106 14 106 139Q106 174 139 264T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 299 34 333T82 404T161 441Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(651,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(1040,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(1612,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(2278.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z" style="stroke-width:3;"></path></g><g data-mml-node="mfrac" transform="translate(3334.6,0)"><g data-mml-node="msup" transform="translate(671.8,394) scale(0.707)"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z" style="stroke-width:3;"></path></g><g data-mml-node="TeXAtom" transform="translate(605,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" style="stroke-width:3;"></path></g></g></g><g data-mml-node="mrow" transform="translate(220,-382.9) scale(0.707)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(500,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z" style="stroke-width:3;"></path></g><g data-mml-node="msup" transform="translate(1278,0)"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z" style="stroke-width:3;"></path></g><g data-mml-node="TeXAtom" transform="translate(605,289) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" style="stroke-width:3;"></path></g></g></g></g><rect width="1816.8" height="60" x="120" y="220"></rect></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline" style="top:0px;left:0px;clip:rect(1px, 1px, 1px, 1px);-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:absolute;padding:1px 0px 0px 0px;border:0px;display:block;width:auto;overflow:hidden;"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>ψ</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><msup><mi>x</mi><mrow data-mjx-texclass="ORD"><mn>4</mn></mrow></msup><mrow><mn>1</mn><mo>+</mo><msup><mi>x</mi><mrow data-mjx-texclass="ORD"><mn>4</mn></mrow></msup></mrow></mfrac></math></mjx-assistive-mml></mjx-container>(其实这个光滑函数也可以进行修改，但是比较麻烦)</p> <h3 id="_2-2-eam势函数设置"><a href="#_2-2-eam势函数设置" class="header-anchor">#</a> 2.2 EAM势函数设置</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>#F 0 3
#T EAM
#I 0 0 0
#E
 
global 1
h 1 0.5 2
 
type morse_sc
cutoff 6.0
D_e     0.10    0.00    1.00
a       2.00    1.00    5.00
r_e     2.50    1.00    5.00
h!
 
type csw2_sc
cutoff 6.0
a       0.20    -2.00   2.00
alpha   2.00    1.00    6.00
phi     0.00    0.00    6.30
beta    3.00    0.50    5.00
h!
 
type bjs
cutoff 6.0
F_0     -1.00   -10.00  0.00
gamma   2.00    0.10    2.00
F_1     2.00    1.00    5.00
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h2 id="_3-程序控制"><a href="#_3-程序控制" class="header-anchor">#</a> 3. 程序控制</h2> <p>通过param文件进行程序运行时的控制</p> <h3 id="_3-1-例子引入"><a href="#_3-1-例子引入" class="header-anchor">#</a> 3.1 例子引入</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>ntypes          1
config          Ni.config
startpot        Ni_eam.pot
endpot          Ni_eam.pot_end
tempfile        Ni_eam.tmp
flagfile        STOP

# Minimization options
opt             1
eng_weight      1
anneal_temp     100

# Output
write_lammps    1

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><code>ntype</code>表示元素的种类数，上述例子中是1种元素的系统；</p> <p><code>config</code>参数后面跟着的是构型文件，例子中构型文件的名称为<code>dummy.config</code></p> <p><code>startpot</code>,<code>endpot</code>,<code>tempfile</code>分别表示初始势函数（一开始设置好的文件），最终势函数（最后调整完的势函数）和临时势函数（中间过程中的势函数，会被不断删除和覆盖）</p> <p><code>flagfile</code>表示终止文件，如果程序检查到了有一个叫做<code>STOP</code>的文件，则会终止优化过程。</p> <p><code>opt</code>取1表示进行优化。</p> <p><code>eng_weight</code>指定能量在优化过程中的权重，往往可以配合stress权重来设置。（但是由于我们之前VASP的计算没有计算box的合应力，所以这里确实少了一个指标）</p> <p><code>anneal_temp</code>是模拟退火算法中的抽象温度，这一算法更有利于找到全局最小值而非局部极小值。</p> <p><code>write_lammps</code>表示以lammps的格式写出。</p> <h2 id="_4-运行结果"><a href="#_4-运行结果" class="header-anchor">#</a> 4. 运行结果</h2> <p>先编译程序（我在ZHANG01上ifxie的home目录下装了intel编译包）：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">source</span> ~/intel/oneapi/setvars.sh 
./waf configure <span class="token parameter variable">-i</span> eam <span class="token parameter variable">-m</span> apot --check-c-compiler<span class="token operator">=</span>gcc
./waf build
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>进行完上述操作后，就可以在bin目录下找到一个可执行程序：potfit_apot_eam_mkl(其实还有一个并行版本，但是这次先尝试串行版本)</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>./potfit_apot_eam_mkl Ni_eam.param
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <footer class="page-edit" style="margin:0;"><div class="edit-link"><a href="https://github.com/IfXie-Solid-Mechanics/my-first-repo/edit/master/DeePMD_kit_Learning/12_potfit_2.md" target="_blank" rel="noopener noreferrer">完善页面</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <!----></div></div>  <main class="footer"> <div class="copy-right"><span class="name"> 编程导航   |     </span> <a target="_blank" rel="noreferrer">
          
        </a></div></main></main> <aside class="page-sidebar"> <div class="page-side-toolbar"></div>  </aside></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.9c486258.js" defer></script><script src="/assets/js/2.f32f27a2.js" defer></script><script src="/assets/js/63.18ac9a4c.js" defer></script>
  </body>
</html>
